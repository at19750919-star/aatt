<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WAA 介面</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
  </head>
<body>
  <header class="header">
    <div class="container"></div>
  </header>
  <main class="container">
    <div class="grid grid-top">
      <!-- 核心：產生牌靴 -->
      <section class="card" id="card-gen">
        <div class="head"><h3>核心</h3><div class="small">設定並創建</div></div>
        <div class="body">
            <div class="actions">
              <div class="input"><label>靴數</label><input id="numShoes" type="number" min="1" max="8" value="1"></div>
              <div class="input"><label>訊號色</label>
                <select id="signalSuit">
                  <option value="H" selected> 紅心 </option>
                  <option value="S">黑桃 </option>
                  <option value="D">方塊 </option>
                  <option value="C">梅花 </option>
              </select>
            </div>
            <div class="input"><label>訊號規則</label>
              <select id="signalRule">
                <option value="suit" selected>花色（現行）</option>
                <option value="red0">紅0（♥/♦ 的 0 點）</option>
                <option value="backcolor">背色模式（BBBR/RRRB）</option>
                <option value="zero0">0 點（任意花色）</option>
              </select>
            </div>
            <div class="input"><label>和局訊號</label>
              <select id="tieSuit">
                <option value="" selected>關閉</option>
                <option value="H">紅心 </option>
                <option value="S">黑桃 </option>
                <option value="D">方塊 </option>
                <option value="C">梅花 </option>
              </select>
            </div>
            <div class="input"><label>尾段</label><input id="multiPassMinCards" type="number" min="1" max="52" value="15"></div>
            <button class="primary" id="btnGen"><span id="spinGen" style="display:none" class="spinner"></span> 創建</button>
          </div>
          <div class="small" id="genInfo" style="margin-top:8px;color:#9fb0c3"></div>
        </div>
      </section>

      <!-- 模擬：切牌與掃描 -->
      <section class="card" id="card-sim">
        <div class="head"><h3>模擬</h3><div class="small">切牌與掃描</div></div>
        <div class="body">
            <div class="actions">
              <div class="input"><label>張數</label><input id="cutPos" type="number" min="0" value="0"></div>
              <div class="input"><label>莊家點</label><input id="bankerPoint" type="number" min="0" max="9" value="0"></div>
              <div class="input"><label>閒家點</label><input id="playerPoint" type="number" min="0" max="9" value="0"></div>
              <div class="input"><label>已用張</label><input id="usedCards" type="number" min="0" max="6" value="0"></div>
              <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
                <div>
                  <button id="btnCut"><span id="spinCut" style="display:none" class="spinner"></span> 切牌</button>
                  <button id="btnScan">換色</button>
                  <button id="btnOpenAssistant" type="button" style="background-color: #17a2b8;">開啟理牌助手</button>
                </div>
                <div>
                  <button class="primary" id="btnExportCombined">導出</button>
                  <button id="btnPreview">預覽</button>
                  <button id="btnExportPreview">Excel</button>
                </div>
              </div>
              <div id="cutSummary" class="cut-summary"></div>
              <span class="small" id="scanInfo"></span>
            </div>
            <!-- 花色訊號警示移到這裡顯示 -->
            <div class="log-panel" id="warningsSignal" style="display:none;margin-top:10px">
              <div class="log-title">花色訊號</div>
              <div class="log-body" id="warningsSignalBody"></div>
            </div>
        </div>
      </section>

      <!-- 統計與導出 -->
      <section class="card" id="card-stats">
        <div class="head"><h3>統計</h3><div class="small">花色+牌面統計</div></div>
        <div class="body">
          <div class="stats" id="suits" style="max-width:100vw;"></div>
          <div id="bptSummary" class="bpt-summary"></div>
          <div>
            <div class="log-panel" id="warningsSwap" style="display:none">
              <div class="log-title">卡色交換警示</div>
              <div class="log-body" id="warningsSwapBody"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- 左右兩表：左細、右預覽 -->
    <div class="grid" id="tables" style="grid-template-columns:3fr 2fr;display:none">
      <section class="card" style="margin:0">
        <div class="head"><h3>詳細表格</h3><div class="small">生成後顯示結果</div></div>
        <div class="body">
          <div class="table-wrap" style="max-height:85vh">
            <table class="table" id="tbl"><thead id="thead"></thead><tbody id="tbody"></tbody></table>
          </div>
        </div>
      </section>
      <section class="card" style="margin:0">
        <div class="head"><h3>預覽與列印</h3><div class="small">右表為預覽</div></div>
        <div class="body">
          <div id="gridPreview" class="grid-preview"></div>
        </div>
      </section>
    </div>

    <!-- 大螢幕預覽 Modal -->
    <div class="modal" id="previewModal">
      <div class="toolbar">
        <button id="btnClosePreview">返回</button>
        <button class="primary" id="btnPrint">列印</button>
      </div>
      <div class="board"><div id="modalGrid" class="grid-preview"></div></div>
    </div>
  </main>
  <div class="toast" id="toast"></div>
  <script src="script.js"></script>
  <script src="signals.js"></script>
</body>
</html>
